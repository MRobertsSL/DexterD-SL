#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

ini_set('display_errors', TRUE);
if (in_array('-h', $argv)) {
	print(\Cundd\PersistentObjectStore\Constants::MESSAGE_CLI_WELCOME . PHP_EOL);
	printf('Usage: %s [port] [ip]' . PHP_EOL, $argv[0]);
	exit;
}

$bootstrap = new \Cundd\PersistentObjectStore\Bootstrap();

/** @var DI\Container $diContainer */
$diContainer = $bootstrap->getDiContainer();

$eventLoop = \React\EventLoop\Factory::create();
$diContainer->set('React\\EventLoop\\LoopInterface', $eventLoop);

$diContainer->get('Cundd\\PersistentObjectStore\\CrashHandler')->register();

/** @var \Cundd\PersistentObjectStore\Server\RestServer $server */
$server = $diContainer->get('Cundd\\PersistentObjectStore\\Server\\RestServer');
$diContainer->set('Cundd\\PersistentObjectStore\\Server\\ServerInterface', $server);

if ($argc > 2) {
	$ip = $argv[2];
	$server->setIp($ip);
}
if ($argc > 1) {
	$port = $argv[1];
	$server->setPort($port);
}
$server->start();


