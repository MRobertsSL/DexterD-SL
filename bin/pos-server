#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

ini_set('display_errors', TRUE);

$bootstrap = new \Cundd\PersistentObjectStore\Bootstrap();

/** @var DI\Container $diContainer */
$diContainer = $bootstrap->getDiContainer();

$eventLoop = \React\EventLoop\Factory::create();
$diContainer->set('React\\EventLoop\\LoopInterface', $eventLoop);

$diContainer->get('Cundd\\PersistentObjectStore\\CrashHandler')->register();

/** @var \Cundd\PersistentObjectStore\Server\RestServer $server */
$server = $diContainer->get('Cundd\\PersistentObjectStore\\Server\\RestServer');
$diContainer->set('Cundd\\PersistentObjectStore\\Server\\ServerInterface', $server);
if ($argc > 1) {
	$port = $argv[1];
	$server->setPort($port);
}
$server->start();


